{% extends "base.html" %}
{% load crispy_forms_tags %}
{% block content %}
<style>
    .form-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }

    input {
        max-width: 40em;
    }

    .flex-container {
    display: flex;
    }
</style>
<div class="flext-container">
    <div class="containerBudget">
        <div class="dropdown float-right dropdown-container">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Budget Options
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <a class="dropdown-item" href="{% url 'budget' budget.pk %}">View Budget</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="{% url 'set_income' income.pk %}">Set Income</a>
            <a class="dropdown-item" href="{% url 'budget_edit' budget.pk %}">Edit Budget Name</a>
            <a class="dropdown-item" href="{% url 'budget_delete' budget.pk %}">Delete Budget</a>
            <a class="dropdown-item" href="{% url 'budget_transactions' budget.pk %}">Transactions</a>
            </div>
        </div>
        <h2>{{ object.name }}</h2>
        <hr class="rounded">
        </br>

        {% if over_budgeted %}
        <div class="warning-box">Your budget is {{ over_budgeted }} over your income</div>
        <hr class="solid">
        {% endif %}

        {% if income %}
        <h4>Monthly Income: {{ income.monthly_income }}</h4>
        <hr class="solid">
    
        {% else %}
        <p>No income data available.</p>
        {% endif %}

        {% for category in categories %}
        <h5>Category: {{ category.name }}</h5>
        <p>Amount Budgeted: {{ category.amount_budgeted }}</p>
        <p>Amount Spent: {{ category.amount_spent}}</p>
        <a href="{% url 'category_detail' category.pk %}" class="btn btn-success btn-sm" style="color:inherit; padding-left: 10px; padding-right: 10px;">View Details</a>
        {% endfor %}
        <hr class="solid">
        <h4>Total Spent: {{ total_spent }}</h4>

        <a href="{% url 'budget_transactions' budget.pk %}" class="btn btn-success btn-sm" style="color:inherit; padding-left: 10px; padding-right: 10px;">Transactions</a>
        </br>
        <form action="" method="post">{% csrf_token %}
            <style type="text/css">
                #id_amount_budgeted_1 {
                    display: none;
                }
            </style>
            {{ form|crispy }}
            <button class="btn btn-success" type="submit">Add Category</button>
        </form>
    </div>
    <div class="containerBudgetGraph" data-monthly-income="{{ income.monthly_income.amount }}" data-total-spent="{{ total_spent.amount }}">
        <div>
            <canvas id="myDoughnutChart" width="400" height="400"></canvas>
        </div>
        <script>
            // Get the context of the canvas element we want to select
            var ctx = document.getElementById('myDoughnutChart').getContext('2d');
    
            // Get the containerBudget div
            var containerBudget = document.querySelector('.containerBudgetGraph');
    
            //console.log(containerBudget.dataset.monthlyIncome);
            //console.log(containerBudget.dataset.totalSpent);
            //var monthlyIncome = parseFloat(containerBudget.dataset.monthlyIncome);
            //var totalSpent = parseFloat(containerBudget.dataset.totalSpent);
            var monthlyIncome = containerBudget.dataset.monthlyIncome;
            var totalSpent = containerBudget.dataset.totalSpent;
            // Create the doughnut chart
            var myDoughnutChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Monthly Income', 'Total Spent'],
                    datasets: [{
                        data: [monthlyIncome, totalSpent], 
                        backgroundColor: ['white', 'green'],
                        borderWidth: 2,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        </script>
    </div>
</div>
{% endblock content %}